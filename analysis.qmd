---
title: "Grader Prompt Score Analysis"
format: html
jupyter: python3
---

This document visualizes how each grader prompt's scores vary across different layer indexes, model scales, strengths, and temperatures.

```{python}
# | echo: false
# | warning: false
from introspection.analysis import load_and_process_data, aggregate_scores

import inspect_viz as viz
from inspect_viz import input, layout
from inspect_viz.mark import line
from inspect_viz.plot import plot
```

## Load Data

```{python}
# | echo: true
df = load_and_process_data("logs/")
print(f"Loaded {len(df)} rows")
print(f"\nColumns: {list(df.columns)}")
print(f"\nGrader prompts: {df['grader_prompt'].unique()}")
print(f"\nModel scales: {df['model_scale'].unique()}")
print(f"\nConditions: {df['condition'].unique()}")
```

## Aggregate Scores

```{python}
# | echo: true
df_agg = aggregate_scores(df)
print(f"Aggregated to {len(df_agg)} rows")
df_agg.head()
```

## Interactive Visualization

```{python}
# | echo: false
# Convert numeric columns to strings for dropdown compatibility
df_agg["strength"] = df_agg["strength"].astype(str)
df_agg["temperature"] = df_agg["temperature"].astype(str)

data = viz.Data(df_agg)
selection = viz.Selection.intersect()

model_scale_filter = input.select(
    data=data,
    column="model_scale",
    target=selection,
    label="Model Scale",
    value="all",
)

strength_filter = input.select(
    data=data,
    column="strength",
    target=selection,
    label="Strength",
    value="all",
)

temperature_filter = input.select(
    data=data,
    column="temperature",
    target=selection,
    label="Temperature",
    value="all",
)

condition_filter = input.select(
    data=data,
    column="condition",
    target=selection,
    label="Condition",
    value="all",
)

# Display filters in a horizontal row
layout.hconcat(model_scale_filter, strength_filter, temperature_filter, condition_filter)
```

```{python}
# | echo: false
# Display the plot separately
plot(
    line(
        data=data,
        x="layer_percentage",
        y="mean_score",
        stroke="grader_prompt",
        filter_by=selection,
        marker="dot",
    ),
    x_label="Layer Percentage",
    y_label="Mean Score (Proportion YES)",
    title="Scores by Layer Percentage",
    width=800,
    height=500,
    legend="color",
)
```
